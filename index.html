<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Orography Factor Playground</title>
    <link rel="stylesheet" href="style.css" />

    <!-- Proj4js (Lambert <-> WGS84 conversions) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.10.0/proj4.min.js" defer></script>

    <!-- App -->
    <script src="script.js" defer></script>
  </head>

  <body>
    <header class="site-header">
      <div class="wrap">
        <h1>Orography Factor Playground</h1>
        <p class="subtitle">
          Enter a location as WGS84 coordinates, an address, or Belgian Lambert coordinates. The app resolves to WGS84,
          fetches elevations around the site, and calculates an orography factor.
        </p>
      </div>
    </header>

    <main class="wrap">
      <section class="card">
        <form id="locationForm" autocomplete="off">
          <div class="row">
            <div class="field">
              <label for="inputType">Input type</label>
              <select id="inputType">
                <option value="lonlat">Longitude &amp; Latitude (WGS84)</option>
                <option value="address">Address</option>
                <option value="lambert">Belgian Lambert coordinates</option>
              </select>
            </div>

            <div class="field">
              <label for="zRef">Reference height z (m)</label>
              <input id="zRef" type="number" inputmode="decimal" step="0.1" min="0" value="10" />
              <div class="hint">Used in the “complex orography” height attenuation term.</div>
            </div>
          </div>

          <!-- LON/LAT -->
          <div id="panelLonLat" class="panel">
            <div class="row">
              <div class="field">
                <label for="lon">Longitude</label>
                <input id="lon" type="number" inputmode="decimal" step="any" placeholder="e.g. 4.3517" />
              </div>
              <div class="field">
                <label for="lat">Latitude</label>
                <input id="lat" type="number" inputmode="decimal" step="any" placeholder="e.g. 50.8503" />
              </div>
            </div>
            <div class="hint">WGS84 decimal degrees.</div>
          </div>

          <!-- ADDRESS -->
          <div id="panelAddress" class="panel hidden">
            <div class="row">
              <div class="field grow">
                <label for="address">Address</label>
                <input
                  id="address"
                  type="text"
                  placeholder="e.g. Rue de la Loi 16, 1000 Bruxelles"
                />
                <div class="hint">Resolved via Open-Meteo Geocoding API.</div>
              </div>
              <div class="field">
                <label for="countryCode">Country</label>
                <input id="countryCode" type="text" maxlength="2" value="BE" />
                <div class="hint">ISO-3166-1 alpha-2</div>
              </div>
            </div>
          </div>

          <!-- LAMBERT -->
          <div id="panelLambert" class="panel hidden">
            <div class="row">
              <div class="field">
                <label for="easting">Easting (X)</label>
                <input id="easting" type="number" inputmode="decimal" step="any" placeholder="e.g. 150000" />
              </div>
              <div class="field">
                <label for="northing">Northing (Y)</label>
                <input id="northing" type="number" inputmode="decimal" step="any" placeholder="e.g. 170000" />
              </div>
            </div>

            <div class="row">
              <div class="field">
                <label for="lambertCrs">Lambert CRS</label>
                <select id="lambertCrs">
                  <option value="auto" selected>Auto-detect</option>
                  <option value="EPSG:31370">Lambert 72 (EPSG:31370)</option>
                  <option value="EPSG:3812">Lambert 2008 (EPSG:3812)</option>
                </select>
                <div class="hint">
                  Auto uses the northing magnitude (Lambert 72 is typically ~5,4M; Lambert 2008 ~0,6–1,8M).
                </div>
              </div>
            </div>
          </div>

          <div class="actions">
            <button id="runBtn" type="submit">Calculate</button>
            <button id="clearBtn" type="button" class="secondary">Clear</button>
          </div>

          <!-- REQUIRED: show coordinates in black below the entry point -->
          <div class="coords-block" aria-live="polite">
            <div class="coords-title">Resolved coordinates</div>
            <div id="coordsLine1" class="coords-line">—</div>
            <div id="coordsLine2" class="coords-line">—</div>
          </div>

          <div id="status" class="status" role="status" aria-live="polite"></div>
        </form>
      </section>

      <section class="card">
        <h2>Result</h2>

        <div class="result-grid">
          <div class="metric">
            <div class="metric-label">Orography factor</div>
            <div class="metric-value"><span id="orography_factor">—</span></div>
            <div id="warning" class="warning hidden"></div>
          </div>

          <div class="metric">
            <div class="metric-label">Site elevation A<sub>c</sub> (m)</div>
            <div class="metric-value"><span id="Ac">—</span></div>
          </div>

          <div class="metric">
            <div class="metric-label">Mean elevation A<sub>m</sub> (m)</div>
            <div class="metric-value"><span id="Am">—</span></div>
          </div>
        </div>

        <details class="details">
          <summary>Show sampled elevations</summary>
          <div class="table-wrap">
            <table id="samplesTable">
              <thead>
                <tr>
                  <th>Point</th>
                  <th>Distance</th>
                  <th>Bearing</th>
                  <th>Lat</th>
                  <th>Lon</th>
                  <th>Elevation (m)</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </details>
      </section>

      <footer class="footer">
        <p>
          Data sources: Open-Meteo Geocoding API &amp; Elevation API (Copernicus DEM).
          Coordinate transforms: Proj4js (EPSG definitions from epsg.io).
        </p>
        <p>All rights reserved © QBIC ARCHITECTEN BV.</p>
      </footer>
    </main>
  </body>
</html>
